<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="js/jquery.soap.js"></script>
<script type="text/javascript" src="js/jquery.format.js"></script>
</head>
<body>
	<h1>Test Canvas</h1>
	<canvas id="game" width="640" height="480"></canvas>
	<br />
	<input type="button" onclick="soapRequest();" value="Click" />
	<br />
	<pre><code id="output"></code></pre>
	<script type="text/javascript">
		// Colores
		verdeConst = "01ff02";

		// Valores cuadrado
		pt = 40;	// Tamannio
		ph = 40;

		p1x = 0;	// Posicion
		p1y = 0;

		vx = 0;		// Velocidad
		vy = 0;
		
		window.onload = function() {
			c = document.getElementById("game");
			cc = c.getContext("2d");
			document.addEventListener("keydown", keyPush);
			posicionInicio();
			setInterval(update, 1000 / 30);
		}

		function update() {
			cc.fillStyle = "black";
			cc.fillRect(0, 0, c.width, c.height);

			crearCirculo(p1x, p1y, 'green', '#003300');
			
			mover();
		}
		
		function posicionInicio() {
			p1x = c.width / 2;	// Posicion
			p1y = c.height / 2;	
		}
		
		function crearRectangulo(){
			cc.fillStyle = "green";
			cc.fillRect(p1x, p1y, pt, ph);
		}
		
		function crearCirculo(x, y, color, colorBorde){
			radius = 20;
			
			cc.beginPath();
			cc.arc(p1x, p1y, radius, 0, 2 * Math.PI, false);
			cc.fillStyle = color;
			cc.fill();
			cc.lineWidth = 5;
			cc.strokeStyle = colorBorde;
			cc.stroke();
		}
		
		function mover(){
			p1x += vx;
			p1y += vy;
			
			if (p1x < 0) { p1x = c.width; }
			if (p1x > c.width) { p1x = 0; }
			if (p1y < 0) { p1y = c.height; }
			if (p1y > c.height) { p1y = 0; }
		}
		
		function keyPush(evt){
			
			vContante = 4;
			
			switch (evt.keyCode) {
			case 37:	// Izq
				vx = -vContante; vy = 0;
				break;
			case 38:	// 
				vx = 0; vy = -vContante; 
				break;
			case 39:
				vx = vContante; vy = 0;
				break;
			case 40:
				vx = 0; vy = vContante;
				break;			
			default:
				vx =  0; vy = 0;
				break;
			}		
		}
		
	</script>
	<script type="text/javascript">

	function soapRequest(){
		
		$.soap({
			url: "http://localhost:8080/TestCanvas/services/ImplMovimiento?wsdl",
			method: "actualizarMovimiento",
			data: {ID: 20, ejeX: 420, ejeY: 421},
			HTTPHeaders:{
				'Content-Type': 'application/xml',
				'Server-Protocol': 'SOAP'
			},
			success: function(response){
				response = $.format(response.toString(),{ method: 'xml'});
				$("#output").text(response);
			},
			error: function(data, status, req) {
		        alert('err'+data.state);
			}
		});
	}
	
	</script>				
</body>
</html>